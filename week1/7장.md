#고급 매핑
- ##고급 매핑
  - 상속 관계매핑
  - @MappedSuperclass
  - 복합 키와 식별관계 매핑
  - 조인 테이블
  - 엔티티 하나에 여러 테이블 매핑하기

##7.1 상속 관계 매핑
### 상속 관계 매핑
객체의 상속 구조와 데이터베이스의 슈퍼타입 서브타입 관계를 매핑하는 것.

### 슈퍼타입 서브타입 논리 모델을 실제 물리 모델인 테이블로 구현하는 방법

1. 각각의 테이블로 구현 (= 조인 전략)
2. 통합 테이블로 변환 (= 단일 테이블 전략)
3. 서브타입 테이블로 변환 (=구현 클래스마다 테이블 전략)

###7.1.1 조인 전략
#### 조인 전략
엔티티 각각을 모두 테이블로 만들고 자식 테이블이 부모 테이블의 기본 키를 받아서 기본 키 + 외래 키로 사용하는 전략이다.
- 조인 전략의 장점 
  - 테이블이 정규화된다.
  - 외래 키 참조 무결성 제약조건을 활용할 수 있다.
  - 저장공간을 효율적으로 사용한다.
- 조인 전략의 단점
  - 조회할 때 조인이 많이 사용되므로 성능이 저하될 수 있다.
  - 조회 쿼리가 복잡하다.
  - 데이터를 등록할 INSERT SQL을 두 번 실행한다.
  
###JPA의 조인 전략을 사용한 매핑 정보 분석

- @Inheritance(strategy=InheritanceType.XXX)의 stategy를 설정해주면 된다.           
default 전략은 SINGLE_TABLE(단일 테이블 전략)이다.
    - InheritanceType 종류
    
      - 조인 전략
      - 단일 테이블 전략
      - 클래스마다 구현된 테이블
- @DiscriminatorColumn(name="DTYPE")

  - 부모 클래스에 선언한다. 하위 클래스를 구분하는 용도의 컬럼이다. 관례는 default = DTYPE

- @DiscriminatorValue("XXX")

  - 하위 클래스에 선언한다. 엔티티를 저장할 때 슈퍼타입의 구분 컬럼에 저장할 값.

###7.1.2 단일 테이블 전략

####단일 테이블 전략    
 테이블 하나만 사용하고 구분 컬럼(DTYPE)으로 어떤 자식 데이터가 저장되었는지 구분한다. 조회할때 일반적으로 가장 빠르다.
- 단일데이터의 장점
  - 조인이 필요 없으므로 일반적으로 조회 성능이 빠르다
  - 조회 쿼리가 단순하다.
- 단일테이블의 단점
  - 자식 엔티티가 매핑한 컬럼은 모두 null을 허용해야 한다.
  - 단일 테이블에 모든것을 저장하므로 테이블이 커질수 있다. 그러므로 상황에 따라서는 조회 성능이 느려질 수 있다.
###7.1.3 구현 클래스마다 테이블 전략
####구현 클래스마다 테이블 전략
조인 전략과 유사하지만, 슈퍼 타입의 컬럼들을 서브 타입으로 내린다. NAME, PRICE 컬럼들이 중복되도록 허용하는 전략이다.
- 구현 클래스마다 테이블전략의 장점
  - 서브 타입을 구분해서 처리할 때 효과적이다.
  - not null 제약조건을 사용할 수 있다.
- 구현 클래스마다 테이블전략의 단점 
  - 여러 자식 테이블을 함께 조회할 때 성능이 느리다.
  - 자식 테이블을 통합해서 쿼리하기 어렵다.
##7.2 MAPPEDSUPERCLASS
### MAPPEDSUPERCLASS
@MAPPEDSUPERCLASS는 테이블과는 관계가 없고 단순히 **엔티티가 공통으로 사용하는 매핑 정보를 모아주는 역할** 을 할 뿐이다.    
**Entity 는 Entity이거나 MAPPEDSUPERCLASS로 지정한 클래스만 상속 받을수 있다.**
##7.3 복합 키와 식별 관계 매핑
###7.3.1 식별 관계 VS 비식별 관계
  - 식별관계
    - 부모 테이블의 기본 키를 내려받아서 자식 테이블의 기본 키 + 외래 키로 사용하는 관계이다.
      - 여기서 기본키와 외래 키란? 
        - 기본키: Primary Key는 여러 키 중에서 가장 중요한 키로서 한 테이블 내에서 중복되지 않는 값만 가질 수 있는 키이다.
        - 외래키: FK키는 특정 테이블에 포함되어 있으면서 다른 테이블의 기본키로 지정된 키 (  테이블을 참조할 때 사용하는 키)
  - 비식별관계 
    - 부모 테이블의 기본 키를 받아서 자식 테이블의 외래 키로만 사용하는 관계다.
      - 필수적 비식별 관계: 외래 키에 NULL을 허용하지 않는다. 연관관계를 필수적으로 맺어야 한다.
      - 선택적 비식별 관계: 외래 키에 NULL을 허용한다. 연관관계를 맺을지 말지 선택할 수 있다.
  
### 7.3.2 복합키: 비식별 관계 매핑
- JPA는 복합 키를 지원하기 위해 @Idclass와 @EmbeddedID 2가지 제공한다.
  - IdClass
    - 관계형 데이터베이스에 가까운 방법
    - 식별자 클래스의 속석명과 엔티티에서 사용하는 식별자의 속성명이 같아야한다    
    - eqauls,hashCode를 구현해야 한다.
    - 식별자 클래스가 public이여야 하고, 기본 생성자가 있어야한다
    - Serializable 인터페이스를 구현해야한다.
  - EmbeddedId
    - 객체지향에 가까운 방법
    - @Embeddable 어노케이션을 붙여주어야한다.
    - 나머지는 IdClass의 특징과 같다.
    - 
- 식별, 비식별 관계의 장단점
    - 데이터베이스 설계 관점에서 보면 다음과 같은 이유로 식별 관계보다는 비식별관계를 선호한다.
###7.4 조인 테이블
- 데이터베이스 테이블의 연관관계를 설계하는 방법은 크게 2ㄱ가지다
  - 조인 컬럼 사용(외래 키)
    - 테이블 간에 관계는 주로 조인 컬럼이라 부르는 외래 키 컬럼을 사용해서 관리한다.
    - @JoinColumn 매핑사용
  - 조인 테이블 사용(테이블 사용)
    - 조인 테이블이라는 별도의 테이블을 사용해서 연관관계를 관리한다.
    - 이 방법은 연관관계를 관리하는 조인 테이블을 추가하고 여기서 두 테이블의 외래 키를 가지고 연관과계를 관리한다.
    - @JoinTable로 매핑한다.
    - 일대다, 일대다, 다대일,다대다 관계에서도 사용한다.
- 조인테이블 사용 (일대일, 일대다, 다대일, 다대다)
  - 일대일 조인 테이블 
    - 조인 테이블의 외래 키 컬럼 각각에 총 2개의 유니크 제약조건을 걸으면 완성
  - 일대다 조인 테이블
    - 조인 테이블의 컬럼 중 다(N)와 관련된 컬럼인 CHILD_ID에 유니크 제약조건을 걸어야한다.
  - 다대일 조인 테이블
    - 일대다 조인 테이블의 반대 방향으로만 설정하면된다.
  - 다대다 조인 테이블
    - 조인 테이블의 두 컬럼을 합해서 하나의 복합 유니크 제약조건을 걸어야 한다.
###7.5 엔티티 하나에 여러 테이블 매핑
- 잘 사용 하지는 않지만 @SecondaryTable을 사용하면 한 엔티티에 여러 테이블을 매핑할 수 있다.

  
  
  
 


